<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Werewords</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üê∫</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #0d0d1a 0%, #1a0a2e 100%);
            min-height: 100vh;
            padding: 0;
            margin: 0;
        }

        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #1a1a2e;
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            z-index: 1001;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #2e2e4e;
        }

        h1 {
            color: #e0d0ff;
            font-size: 1.5em;
            margin: 0;
        }

        .header-reset-button {
            padding: 8px 16px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: none;
        }

        .header-reset-button:hover {
            background: #da190b;
        }

        .header-reset-button:active {
            transform: scale(0.95);
        }

        .container {
            width: 100%;
            max-width: 600px;
            margin: 66px auto 0;
            background: #1e1e32;
            border-radius: 16px;
            padding: 20px 20px 90px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
            border: 1px solid #2e2e4e;
        }

        .setup-screen {
            display: block;
        }

        .game-screen {
            display: none;
        }

        .roles-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .role-button {
            padding: 14px 10px;
            border: 2px solid #2e2e4e;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
            background: #14142a;
            color: #555;
            opacity: 0.55;
            aspect-ratio: 1 / 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .role-emoji {
            font-size: 30px;
            line-height: 1;
        }

        .role-label {
            font-size: 9px;
            font-weight: 800;
            letter-spacing: 0.06em;
            margin-top: 2px;
            opacity: 0.7;
            text-transform: uppercase;
        }

        .role-button.mayor {
            border-color: #3a3010;
        }

        .role-button.mayor.active {
            background: #3a2800;
            color: #ffd700;
            border-color: #f57f17;
            opacity: 1;
            box-shadow: 0 4px 14px rgba(255, 215, 0, 0.3);
        }

        .role-button.villager {
            border-color: #1a3a1e;
        }

        .role-button.villager.active {
            background: #0d2e10;
            color: #4caf50;
            border-color: #2e7d32;
            opacity: 1;
            box-shadow: 0 4px 14px rgba(76, 175, 80, 0.35);
        }

        .role-button.werewolf {
            border-color: #3a1010;
        }

        .role-button.werewolf.active {
            background: #2e0a0a;
            color: #f44336;
            border-color: #c62828;
            opacity: 1;
            box-shadow: 0 4px 14px rgba(244, 67, 54, 0.35);
        }

        .role-button.seer {
            border-color: #10203a;
        }

        .role-button.seer.active {
            background: #091828;
            color: #64b5f6;
            border-color: #1565c0;
            opacity: 1;
            box-shadow: 0 4px 14px rgba(33, 150, 243, 0.35);
        }

        .role-button.mason {
            border-color: #2a1e08;
        }

        .role-button.mason.active {
            background: #201400;
            color: #ffb300;
            border-color: #8b6200;
            opacity: 1;
            box-shadow: 0 4px 14px rgba(255, 179, 0, 0.3);
        }

        .role-button.fortune-teller {
            border-color: #2a0e3a;
        }

        .role-button.fortune-teller.active {
            background: #1a0828;
            color: #ce93d8;
            border-color: #7b1fa2;
            opacity: 1;
            box-shadow: 0 4px 14px rgba(206, 147, 216, 0.35);
        }

        .role-button.minion {
            border-color: #3a1e08;
        }

        .role-button.minion.active {
            background: #2a1000;
            color: #ff9800;
            border-color: #e65100;
            opacity: 1;
            box-shadow: 0 4px 14px rgba(255, 152, 0, 0.35);
        }

        .role-button.apprentice {
            border-color: #0a2a2a;
        }

        .role-button.apprentice.active {
            background: #001a1a;
            color: #4dd0e1;
            border-color: #00838f;
            opacity: 1;
            box-shadow: 0 4px 14px rgba(77, 208, 225, 0.35);
        }

        .role-button.beholder {
            border-color: #2a2808;
        }

        .role-button.beholder.active {
            background: #1a1600;
            color: #fff176;
            border-color: #f9a825;
            opacity: 1;
            box-shadow: 0 4px 14px rgba(255, 241, 118, 0.3);
        }

        .role-button.thing {
            border-color: #0a2020;
        }

        .role-button.thing.active {
            background: #001818;
            color: #80cbc4;
            border-color: #00695c;
            opacity: 1;
            box-shadow: 0 4px 14px rgba(128, 203, 196, 0.3);
        }

        .role-button.doppleganger {
            border-color: #1c1c28;
        }

        .role-button.doppleganger.active {
            background: #0e0e1e;
            color: #b0bec5;
            border-color: #546e7a;
            opacity: 1;
            box-shadow: 0 4px 14px rgba(176, 190, 197, 0.3);
        }

        .role-button:active {
            transform: scale(0.95);
        }

        .categories-section {
            margin-top: 20px;
            margin-bottom: 30px;
        }

        .category-summary {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 15px;
            border: 2px solid #2e2e4e;
            border-radius: 10px;
            background: #14142a;
            cursor: default;
        }

        .category-summary-text {
            font-size: 15px;
            color: #a0a0c0;
            font-weight: 500;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            min-width: 0;
        }

        .category-cog-button {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 6px;
            transition: background 0.2s;
            line-height: 1;
        }

        .category-cog-button:hover {
            background: #2e2e4e;
        }

        .category-screen {
            display: none;
        }

        .category-screen-title {
            font-size: 18px;
            font-weight: 700;
            color: #e0d0ff;
            margin-bottom: 20px;
        }

        .category-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 25px;
        }

        .category-button {
            padding: 8px 14px;
            border: 2px solid #6b5fc7;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            background: transparent;
            color: #9b8fff;
            text-transform: capitalize;
        }

        .category-button.active {
            background: #6b5fc7;
            color: #fff;
        }

        .category-button:active {
            transform: scale(0.95);
        }

        .setup-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #1a1a2e;
            padding: 12px 16px;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.5);
            border-top: 1px solid #2e2e4e;
            z-index: 1000;
        }

        .play-button {
            width: 100%;
            max-width: 576px;
            margin: 0 auto;
            display: block;
            padding: 18px;
            background: linear-gradient(135deg, #4a3fa0 0%, #6b2fa0 100%);
            color: #e0d0ff;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(80, 60, 180, 0.4);
        }

        .play-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(100, 70, 200, 0.6);
        }

        .play-button:active {
            transform: translateY(0);
        }

        .play-button:disabled {
            background: #2a2a3e;
            color: #555;
            cursor: not-allowed;
            box-shadow: none;
        }

        .oops-button {
            margin-top: 16px;
            padding: 10px 24px;
            background: transparent;
            color: #7070a0;
            border: 1px solid #3a3a5e;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .oops-button:hover {
            background: #2a2a42;
            color: #a0a0c8;
            border-color: #5a5a8e;
        }

        .oops-button:active {
            transform: scale(0.96);
        }

        .word-category-label {
            display: block;
            font-size: 11px;
            font-weight: 400;
            opacity: 0.65;
            margin-top: 4px;
            text-transform: capitalize;
        }

        .game-content {
            text-align: center;
        }

        .instruction {
            font-size: 24px;
            color: #d0c0ff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #14142a;
            border: 1px solid #2e2e4e;
            border-radius: 12px;
            padding: 20px;
            flex-direction: column;
        }

        .word-selection {
            display: none;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }

        .word-button {
            padding: 20px;
            background: #2a2060;
            color: #c0b0ff;
            border: 2px solid #4a3fa0;
            border-radius: 10px;
            font-size: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .word-button:hover {
            background: #3a2e80;
            transform: translateY(-2px);
        }

        .word-display {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            font-size: 48px;
            font-weight: bold;
            color: #a78bfa;
            padding: 30px;
            background: #14142a;
            border: 1px solid #2e2e4e;
            border-radius: 12px;
            margin: 20px 0;
            text-transform: uppercase;
        }

        .word-display .word-upside-down {
            display: inline-block;
            transform: rotate(180deg);
        }

        .word-display .word-divider {
            width: 80%;
            height: 2px;
            background: #2e2e4e;
            border-radius: 1px;
        }

        .word-display .word-hint {
            font-size: 0.9em;
            letter-spacing: 0.2em;
            color: #ce93d8;
        }

        .timer {
            font-size: 64px;
            font-weight: bold;
            color: #a78bfa;
            margin: 20px 0;
        }

        .timer.warning {
            color: #f44336;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .outcome-buttons {
            display: none;
            flex-direction: column;
            gap: 15px;
            width: 100%;
        }

        .outcome-button {
            padding: 20px;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .outcome-button.success {
            background: #4caf50;
            color: white;
        }

        .outcome-button.failure {
            background: #ff9800;
            color: white;
        }

        .outcome-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .game-buttons-fixed {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #1a1a2e;
            padding: 20px;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.5);
            border-top: 1px solid #2e2e4e;
            z-index: 1000;
        }

        .next-button {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            display: block;
            padding: 25px;
            background: #1e6e22;
            color: #b0f0b4;
            border: none;
            border-radius: 10px;
            font-size: 20px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .next-button:hover {
            background: #25882a;
        }

        .next-button:active {
            transform: scale(0.98);
        }

        .game-content {
            padding-bottom: 120px;
        }

        @media (max-width: 600px) {
            .header {
                padding: 10px 14px;
            }

            h1 {
                font-size: 1.15em;
            }

            .container {
                margin-top: 50px;
                border-radius: 0;
                padding: 10px 10px 80px;
                box-shadow: none;
                border: none;
                border-top: 1px solid #2e2e4e;
            }

            .roles-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 5px;
                margin-bottom: 8px;
            }

            .role-button {
                padding: 6px 3px;
            }

            .role-emoji {
                font-size: 20px;
            }

            .role-label {
                font-size: 6.5px;
                letter-spacing: 0.01em;
            }

            .categories-section {
                margin-top: 6px;
                margin-bottom: 0;
            }

            .setup-footer {
                padding: 10px 12px;
            }

            .play-button {
                padding: 15px;
                font-size: 16px;
            }
        }

        @media (min-width: 601px) and (max-width: 900px) {
            .roles-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 10px;
            }

            .role-emoji {
                font-size: 26px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üê∫ Werewords</h1>
        <button class="header-reset-button" id="headerResetButton">Reset Game</button>
    </div>

    <div class="container">
        <!-- Setup Screen -->
        <div class="setup-screen" id="setupScreen">
            <div class="roles-grid" id="rolesGrid"></div>
            <div class="categories-section">
                <div class="category-summary">
                    <span class="category-summary-text" id="categorySummaryText">Categor√≠a: Todas</span>
                    <button class="category-cog-button" id="categoryCogButton">‚öôÔ∏è</button>
                </div>
            </div>
        </div>

        <!-- Category Screen -->
        <div class="category-screen" id="categoryScreen">
            <h2 class="category-screen-title">Seleccionar Categor√≠as</h2>
            <div class="category-grid" id="categoryGrid"></div>
            <button class="play-button" id="categoryDoneButton">Listo ‚úì</button>
        </div>

        <!-- Game Screen -->
        <div class="game-screen" id="gameScreen">
            <div class="game-content">
                <div class="instruction" id="instruction">
                    <div id="instructionText"></div>
                    <div class="word-selection" id="wordSelection"></div>
                    <div class="word-display" id="wordDisplay"></div>
                    <div class="timer" id="timer"></div>
                    <button class="oops-button" id="oopsButton" style="display:none;">‚Ü© Oops, volver</button>
                </div>
                <div class="outcome-buttons" id="outcomeButtons">
                    <button class="outcome-button success" id="wordGuessed">Word Guessed! (Werewolves find Seer)</button>
                    <button class="outcome-button failure" id="wordNotGuessed">Word Not Guessed (Find Werewolves)</button>
                </div>
            </div>
            <div class="game-buttons-fixed">
                <button class="next-button" id="nextButton">Next</button>
            </div>
        </div>
    </div>

    <div class="setup-footer" id="setupFooter">
        <button class="play-button" id="playButton">Start Game</button>
    </div>

    <script>
        // Game state
        const roles = [
            { type: 'villager', count: 8, label: 'Villager', active: false },
            { type: 'werewolf', count: 3, label: 'Werewolf', active: false },
            { type: 'seer', count: 1, label: 'Seer', active: false },
            { type: 'mason', count: 2, label: 'Mason', active: false },
            { type: 'fortune-teller', count: 1, label: 'Fortune Teller', active: false },
            { type: 'minion', count: 1, label: 'Minion', active: false },
            { type: 'apprentice', count: 1, label: 'Apprentice', active: false },
            { type: 'beholder', count: 1, label: 'Beholder', active: false },
            { type: 'thing', count: 1, label: 'Thing', active: false },
            { type: 'doppleganger', count: 1, label: 'Doppleganger', active: false }
        ];

        let selectedRoles = [];
        let currentPhaseIndex = 0;
        let gamePhases = [];
        let selectedWord = '';
        let selectedWordCategory = '';
        let timerInterval = null;
        let mayorRole = null;

        const wordCategories = {
            comida: ['PIZZA', 'HAMBURGUESA', 'TACO', 'SUSHI', 'PASTA', 'ENSALADA', 'CHOCOLATE', 'GALLETITAS', 'TORTA', 'PAN', 'ARROZ', 'PAELLA', 'LASA√ëA', 'CEVICHE', 'EMPANADA', 'ASADO', 'STEAK', 'POLLO FRITO', 'RAMEN', 'CURRY', 'FALAFEL', 'HUMMUS', 'HOT DOG', 'NACHOS', 'BURRITO', 'GUACAMOLE', 'SOPA', 'SANGUCHE', 'KEBAB', 'FISH AND CHIPS', 'PASTEL DE CARNE', 'POLLO ASADO', 'TORTILLA DE PATATA', 'GAZPACHO', 'RISOTTO', 'GNOCCHI', 'RAVIOLI', 'NUGGETS', 'PAPA FRITA', 'PURE DE PAPA', 'ALBONDIGAS', 'CROQUETAS', 'AREPA', 'TAMAL', 'CHILAQUILES', 'ENCHILADAS', 'QUESADILLA', 'PANCETA', 'SALCHICHA', 'HUEVOS REVUELTOS', 'OMELETTE', 'CREPA', 'WAFFLE', 'PANQUEQUE', 'DONA', 'HELADO', 'CHURROS', 'ALFAJOR', 'FLAN', 'GELATINA', 'YOGUR', 'CEREAL', 'AVENA', 'BAGUETTE', 'PRETZEL', 'CROISSANT', 'MUFFIN', 'BROWNIE', 'TARTA DE MANZANA', 'SUSPIRO LIMENO', 'BACALAO', 'SALMON', 'ATUN', 'CAMARONES', 'LANGOSTA', 'PULPO'],
            animales: ['PERRO', 'GATO', 'CABALLO', 'VACA', 'CERDO', 'OVEJA', 'CABRA', 'CONEJO', 'GALLINA', 'PATO', 'LEON', 'TIGRE', 'ELEFANTE', 'JIRAFA', 'CEBRA', 'HIPOPOTAMO', 'RINOCERONTE', 'GORILA', 'MONO', 'CHIMPANCE', 'CANGURO', 'KOALA', 'OSO PANDA', 'OSO POLAR', 'OSO PARDO', 'LOBO', 'ZORRO', 'COYOTE', 'HIENA', 'GUEPARDO', 'LEOPARDO', 'PANTERA', 'PUMA', 'JAGUAR', 'LINCE', 'CIERVO', 'ALCE', 'RENO', 'CAMELLO', 'LLAMA', 'ALPACA', 'GUANACO', 'VICUNA', 'BUFALO', 'BISONTE', 'ANTILOPE', 'GACELA', 'SURICATA', 'CASTOR', 'NUTRIA', 'FOCA', 'MORSA', 'LEON MARINO', 'BALLENA', 'DELFIN', 'ORCA', 'TIBURON', 'RAYA', 'PULPO', 'CALAMAR', 'MEDUSA', 'ESTRELLA DE MAR', 'CABALLITO DE MAR', 'PINGUINO', 'AVESTRUZ', 'AGUILA', 'HALCON', 'BUHO', 'LECHUZA', 'LORO', 'GUACAMAYO', 'TUCAN', 'COLIBRI', 'CISNE', 'FLAMENCO', 'PELICANO', 'CIGUENA', 'CUERVO', 'PALOMA', 'GORRION', 'MURCIELAGO', 'COCODRILO', 'CAIMAN', 'TORTUGA', 'SERPIENTE', 'VIBORA', 'IGUANA', 'CAMALEON', 'LAGARTIJA', 'SALAMANDRA', 'RANA', 'SAPO', 'ABEJA', 'AVISPA', 'HORMIGA', 'MARIPOSA', 'POLILLA', 'ESCARABAJO', 'SALTAMONTES', 'GRILLO', 'MANTIS RELIGIOSA', 'ARANA', 'ESCORPION', 'CIEMPIES', 'CARACOL', 'BABOSA', 'LOMBRIZ'],
            plantas: ['ROSA', 'ARBOL', 'CACTUS', 'GIRASOL', 'TULIPAN', 'ORQUIDEA', 'BAMBU', 'PAPA', 'BERENJENA', 'BATATA', 'ZANAHORIA', 'TOMATE', 'LECHUGA', 'CEBOLLA', 'AJO', 'PEPINO', 'CALABAZA', 'ESPINACA', 'BROCOLI', 'COLIFLOR', 'REPOLLO', 'ARVEJA', 'LENTEJA', 'MAIZ', 'TRIGO', 'MANZANA', 'PERA', 'BANANA', 'NARANJA', 'LIMON', 'UVA', 'FRUTILLA', 'SANDIA', 'MELON', 'ANANA', 'MANGO', 'PALTA', 'DURAZNO', 'CIRUELA', 'CEREZA', 'HIGO', 'KIWI', 'ARANDANO', 'FRAMBUESA', 'MORA', 'COCO', 'NUEZ', 'ALMENDRA', 'AVELLANA', 'CASTANA', 'PINO', 'ROBLE', 'EUCALIPTO', 'SAUCE', 'PALMERA', 'HELECHO', 'MUSGO', 'ALGA', 'LAVANDA', 'MENTA', 'ALBAHACA', 'ROMERO', 'TOMILLO', 'OREGANO', 'PEREJIL', 'CILANTRO', 'MARGARITA', 'CLAVEL', 'LIRIO', 'AMAPOLA', 'JAZMIN', 'GERANIO', 'HORTENSIA', 'ALOE VERA', 'BONSAI', 'TREBOL', 'OLIVO', 'VID', 'CACAO', 'CAFE', 'TE'],
            personas: ['ALBERT EINSTEIN', 'ELON MUSK', 'DONALD TRUMP', 'BRAD PITT', 'MARADONA', 'CRISTIANO RONALDO', 'MICHAEL JORDAN', 'SHAKIRA', 'MADONNA', 'MICHAEL JACKSON', 'ELVIS PRESLEY', 'BEATLES', 'QUEEN', 'BEYONCE', 'TAYLOR SWIFT', 'LADY GAGA', 'RIHANNA', 'JUSTIN BIEBER', 'BILL GATES', 'STEVE JOBS', 'MARK ZUCKERBERG', 'JEFF BEZOS', 'WALT DISNEY', 'BARACK OBAMA', 'NELSON MANDELA', 'MAHATMA GANDHI', 'MARTIN LUTHER KING', 'DALAI LAMA', 'PAPA FRANCISCO', 'JUANA DE ARCO', 'CLEOPATRA', 'JULIO CESAR', 'NAPOLEON', 'ALEJANDRO MAGNO', 'LEONARDO DA VINCI', 'MIGUEL ANGEL', 'PABLO PICASSO', 'VINCENT VAN GOGH', 'FRIDA KAHLO', 'SALVADOR DALI', 'SHAKESPEARE', 'CERVANTES', 'ISAAC NEWTON', 'CHARLES DARWIN', 'MARIE CURIE', 'NIKOLA TESLA', 'GALILEO GALILEI', 'ARISTOTELES', 'PLATON', 'SOCRATES', 'MOZART', 'BEETHOVEN', 'CHOPIN', 'MARILYN MONROE', 'AUDREY HEPBURN', 'CHARLIE CHAPLIN', 'ELIZABETH TAYLOR', 'TOM CRUISE', 'LEONARDO DICAPRIO', 'MERYL STREEP', 'ANGELINA JOLIE', 'WILL SMITH', 'JOHNNY DEPP', 'ROBERT DOWNEY JR', 'SCARLETT JOHANSSON', 'MORGAN FREEMAN', 'STEVEN SPIELBERG', 'OPRAH WINFREY', 'PRINCIPESA DIANA', 'REINA ISABEL II', 'MARGARET THATCHER', 'WINSTON CHURCHILL', 'ABRAHAM LINCOLN', 'GEORGE WASHINGTON', 'CHE GUEVARA', 'FIDEL CASTRO', 'SIMON BOLIVAR', 'JOSE DE SAN MARTIN', 'MALALA YOUSAFZAI', 'GRETA THUNBERG', 'NEIL ARMSTRONG', 'YURI GAGARIN', 'MUHAMMAD ALI', 'ROGER FEDERER', 'RAFAEL NADAL', 'SERENA WILLIAMS', 'TIGER WOODS', 'USAIN BOLT', 'LEBRON JAMES', 'PELE', 'ZIDANE', 'RONALDINHO', 'BAD BUNNY', 'ROSALIA', 'J BALVIN', 'MALUMA', 'RICKY MARTIN', 'LUIS MIGUEL', 'JULIO IGLESIAS', 'CRISTINA KIRCHNER', 'RICARDO DARIN', 'GUILLERMO FRANCELLA', 'LIONEL MESSI', 'CHARLY GARCIA', 'GUSTAVO CERATI', 'JAVIER MILEI'],
            lugares: ['ESPA√ëA', 'MEXICO', 'ARGENTINA', 'COLOMBIA', 'CHILE', 'PERU', 'ESTADOS UNIDOS', 'FRANCIA', 'ITALIA', 'ALEMANIA', 'REINO UNIDO', 'JAPON', 'CHINA', 'BRASIL', 'CANADA', 'RUSIA', 'AUSTRALIA', 'EGIPTO', 'GRECIA', 'INDIA', 'PORTUGAL', 'PAISES BAJOS', 'SUIZA', 'SUECIA', 'NORUEGA', 'BELGICA', 'AUSTRIA', 'MARRUECOS', 'TURQUIA', 'ISRAEL', 'ARABIA SAUDITA', 'SUDAFRICA', 'NIGERIA', 'CUBA', 'REPUBLICA DOMINICANA', 'COSTA RICA', 'PANAMA', 'VENEZUELA', 'URUGUAY', 'ECUADOR', 'BOLIVIA', 'PARAGUAY', 'GUATEMALA', 'HONDURAS', 'EL SALVADOR', 'NICARAGUA', 'FILIPINAS', 'COREA DEL SUR', 'TAILANDIA', 'NUEVA ZELANDA', 'MADRID', 'BARCELONA', 'VALENCIA', 'SEVILLA', 'CIUDAD DE MEXICO', 'BUENOS AIRES', 'BOGOTA', 'LIMA', 'SANTIAGO', 'CARACAS', 'QUITO', 'MONTEVIDEO', 'LA HABANA', 'SAN JOSE', 'CIUDAD DE GUATEMALA', 'ASUNCION', 'NUEVA YORK', 'PARIS', 'LONDRES', 'ROMA', 'BERLIN', 'TOKIO', 'PEKIN', 'MOSCU', 'AMSTERDAM', 'VIENA', 'PRAGA', 'ATENAS', 'ESTAMBUL', 'EL CAIRO', 'JERUSALEN', 'DUBAI', 'SINGAPUR', 'BANGKOK', 'SEUL', 'SIDNEY', 'LOS ANGELES', 'MIAMI', 'RIO DE JANEIRO', 'SAO PAULO', 'MEXICO DF', 'GUADALAJARA', 'MONTERREY', 'MEDELLIN', 'CANCUN', 'LAS VEGAS', 'SAN FRANCISCO', 'VANCOUVER', 'LISBOA', 'MARRAKECH', 'ROSARIO', 'ROLDAN', 'MALVINAS', 'TORRE EIFFEL', 'TAJ MAHAL', 'CATARATAS DEL IGUAZU', 'GRAN MURALLA CHINA', 'COLISEO ROMANO', 'ESTATUA DE LA LIBERTAD', 'MACHU PICCHU', 'PIRAMIDES DE GIZA', 'CRISTO REDENTOR', 'CHICHEN ITZA', 'ACROPOLIS DE ATENAS', 'BIG BEN', 'CATEDRAL DE NOTRE DAME', 'SAGRADA FAMILIA', 'GRAN CANON DEL COLORADO', 'PALACIO DE VERSALLES', 'OPERA DE SIDNEY', 'BASILICA DE SAN PEDRO', 'ALHAMBRA DE GRANADA', 'MURO DE LAS LAMENTACIONES', 'PETRA', 'ANGKOR WAT', 'SALAR DE UYUNI', 'ISLA DE PASCUA', 'MONTE EVEREST', 'CATARATAS DEL NIAGARA', 'PUENTE GOLDEN GATE', 'EMPIRE STATE BUILDING', 'LOUVRE', 'CANALES DE VENECIA', 'MEZQUITA DE CORDOBA', 'TEOTIHUACAN', 'TORRE DE PISA', 'SALTO ANGEL', 'MONTE FUJI', 'CAPILLA SIXTINA', 'SANTORINI', 'STONEHENGE', 'CIUDAD PROHIBIDA', 'BURJ KHALIFA', 'MUSEO DEL PRADO', 'GRAN BARRERA DE CORAL', 'PARQUE NATIONAL YOSEMITE', 'ULURU', 'CATARATAS VICTORIA', 'KILIMANJARO', 'CATEDRAL DE SAN BASILIO', 'PANTENON DE ROMA', 'GLACIAR PERITO MORENO', 'MONTS SAINT MICHEL'],
            objetos: ['TELEFONO', 'LIBRO', 'AUTO', 'SILLA', 'LAMPARA', 'RELOJ', 'ESPEJO', 'CAMARA', 'GUITARRA', 'BICICLETA', 'CAMA', 'MESA', 'CUADRO', 'VENTANA', 'PUERTA', 'ARMARIO', 'ALMOHADA', 'SABANA', 'TOALLA', 'JABON', 'CEPILLO', 'PASTA DE DIENTES', 'CHAMPU', 'PEINE', 'SECADOR', 'PLANCHA', 'LAVARROPAS', 'HELADERA', 'MICROONDAS', 'HORNO', 'COCINA', 'SARTEN', 'OLLA', 'PLATO', 'VASO', 'COPA', 'TENEDOR', 'CUCHILLO', 'CUCHARA', 'SERVILLETA', 'MANTEL', 'CAFETERA', 'TOSTADORA', 'LICUADORA', 'PAVA', 'MATE', 'TERMO', 'MOCHILA', 'CARTERA', 'BILLETERA', 'LLAVE', 'MONEDA', 'BILLETE', 'RELOJ DE PULSERA', 'ANTEOJOS', 'GORRA', 'ZAPATO', 'ZAPATILLA', 'BOTA', 'SANDALIA', 'MEDIAS', 'PANTALON', 'REMERA', 'CAMISA', 'CAMPERA', 'ABRIGO', 'BUFANDA', 'GUANTES', 'CINTURON', 'CORBATA', 'RELOJ DE PARED', 'CALENDARIO', 'LAPICERA', 'LAPIZ', 'GOMA', 'SACAPUNTAS', 'REGLA', 'TIJERA', 'PEGAMENTO', 'CINTA ADHESIVA', 'CARPETA', 'CUADERNO', 'PAPEL', 'SOBRE', 'ESTUCHE', ' CALCULADORA', 'COMPUTADORA', 'TECLADO', 'MOUSE', 'MONITOR', 'IMPRESORA', 'AURICULARES', 'PARLANTE', 'TELEVISOR', 'CONTROL REMOTO', 'CONSOLA', 'CABLE', 'CARGADOR', 'BATERIA', 'LINTERNA', 'VELA', 'FOSFORO', 'ENCENDEDOR', 'CENICERO', 'PARAGUAS', 'ESCOBA', 'PALA', 'BALDE', 'TRAPO', 'ESPONJA', 'DETERGENTE', 'BOLSA', 'CESTO', 'PERCHA', 'ALFILETERO', 'AGUJA', 'HILO', 'BOTON', 'DEDAL', 'PLANCHA DE PELO', 'MAQUINA DE AFEITAR', 'PERFUME', 'DESODORANTE', 'CREMA', 'MAQUILLAJE', 'ESMALTE', 'MALETA', 'CANDADO', 'HERRAMIENTA', 'MARTILLO', 'DESTORNILLADOR', 'PINZA', 'CLAVO', 'TORNILLO', 'ESCALERA', 'MANGUERA', 'MACETA', 'REGADERA', 'BANCO', 'ALFOMBRA', 'CORTINA', 'COJIN', 'FLORERO', 'RELOJ DESPERTADOR', 'RADIO', 'BRUJULA', 'MAPA', 'DICCIONARIO', 'REVISTA'],
            abstracto: ['AMOR', 'LIBERTAD', 'PAZ', 'JUSTICIA', 'ESPERANZA', 'CORAJE', 'SABIDURIA', 'VERDAD', 'BELLEZA', 'SUENO', 'FELICIDAD', 'ODIO', 'TRISTEZA', 'IRA', 'MIEDO', 'PODER', 'TIEMPO', 'MUERTE', 'VIDA', 'SOLEDAD', 'AMISTAD', 'LEALTAD', 'HONESTIDAD', 'RESPETO', 'IGUALDAD', 'HONOR', 'FE', 'DESTINO', 'CAOS', 'ORDEN', 'MEMORIA', 'OLVIDO', 'RECUERDO', 'RAZON', 'PASION', 'DOLOR', 'PLACER', 'SILENCIO', 'SONIDO', 'ALMA', 'ESPIRITU', 'CONCIENCIA', 'CULPA', 'PERDON', 'VIRTUD', 'VICIO', 'MALDAD', 'BONDAD', 'EGOISMO', 'ALTRUISMO', 'ENVIDIA', 'COVARDIA', 'ORGULLO', 'HUMILDAD', 'PACIENCIA', 'AMBICION', 'EXITO', 'FRACASO', 'RIQUEZA', 'POBREZA', 'SALUD', 'ENFERMEDAD', 'ETERNIDAD', 'INFINITO', 'LOGICA', 'MORAL', 'ETICA', 'FILOSOFIA', 'CIENCIA', 'RELIGION', 'CULTURA', 'TRADICION', 'CAMBIO', 'PROGRESO', 'UTOPIA'],
            trabajos: ['INGENIERO', 'ENFERMERO', 'ABOGADO', 'CIENTIFICO', 'GRANJERO', 'PLOMERO', 'ARQUITECTO', 'FOTOGRAFO', 'CONTADOR', 'BOMBERO', 'POLICIA', 'MAESTRO', 'MEDICO', 'CARPINTERO', 'ELECTRICISTA', 'COCINERO', 'MESERO', 'CHOFER', 'MECANICO', 'DENTISTA', 'VETERINARIO', 'PERIODISTA', 'PSICOLOGO', 'DISENADOR', 'PROGRAMADOR', 'ARTISTA', 'MUSICO', 'ACTOR', 'ESCRITOR', 'BIBLIOTECARIO', 'CARTERO', 'ALBANIL', 'PINTOR', 'JARDINERO', 'PELUQUERO', 'SASTRE', 'PILOTO', 'AZAFATA', 'MARINERO', 'MINERO', 'SOLDADO', 'JUEZ', 'ECONOMISTA', 'BIOLOGO', 'ASTRONAUTA', 'GEOLOGO', 'ARQUEOLOGO', 'SOCIOLOGO', 'FILOSOFO', 'DEPORTISTA'],
            peliculas: ['TITANIC', 'AVATAR', 'EL ORIGEN', 'TIBURON', 'FROZEN', 'GLADIADOR', 'ROCKY', 'SHREK', 'UP', 'EL PADRINO', 'PULP FICTION', 'FORREST GUMP', 'EL REY LEON', 'TOY STORY', 'STAR WARS', 'VOLVER AL FUTURO', 'JURASSIC PARK', 'EL CABALLERO DE LA NOCHE', 'EL SENOR DE LOS ANILLOS', 'HARRY POTTER', 'MATRIX', 'EL CLUB DE LA PELEA', 'MILAGROS INESPERADOS', 'LA LISTA DE SCHINDLER', 'BUSCANDO A NEMO', 'LOS INCREIBLES', 'RATATOUILLE', 'COCO', 'EL EXORCISTA', 'EL RESPLANDOR', 'PSICOSIS', 'ALIEN EL OCTAVO PASAJERO', 'TERMINATOR', 'ROBOCOP', 'EL SILENCIO DE LOS INOCENTES', 'CORAZON VALIENTE', 'EL SHOW DE TRUMAN', 'BASTARDOS SIN GLORIA', 'DJANGO SIN CADENAS', 'LOS JUEGOS DEL HAMBRE', 'CREPUSCULO', 'SPIDERMAN', 'LOS VENGADORES', 'IRON MAN', 'EL LOBO DE WALL STREET', 'GRAN TORINO', 'LA NARANJA MECANICA', 'TAXI DRIVER', 'CUIDADANO KANE', 'CASABLANCA', 'LO QUE EL VIENTO SE LLEVO', 'EL MAGO DE OZ', 'LA NOVICIA REBELDE', 'CANTANDO BAJO LA LLUVIA', 'MISION IMPOSIBLE', 'DURO DE MATAR', 'ARMA MORTAL', 'INDIANA JONES', 'ET EL EXTRATERRESTRE', 'GREMLINS', 'LOS CAZAFANTASMAS', 'MI POBRE ANGELITO', 'EL JOVEN MANOS DE TIJERAS', 'EL EXTRA√ëO MUNDO DE JACK', 'SENSE Y SENSIBILIDAD', 'ORGULLO Y PREJUICIO', 'MUJERCITAS', 'DIARIO DE UNA PASION', 'CUESTION DE TIEMPO', 'LA LA LAND', 'NACIO UNA ESTRELLA', 'BOHEMIAN RHAPSODY', 'EL PIANISTA', 'LA VIDA ES BELLA', 'PARASITOS', 'EL LABERINTO DEL FAUNO', 'ROMA', 'AMELIE', 'EL GRAN HOTEL BUDAPEST', 'MAD MAX', 'BLADE RUNNER', 'EL QUINTO ELEMENTO', 'EL PERFECTO ASESINO', 'RESIDEV EVIL', 'EL ARO', 'EL CONJURO', 'ACTIVIDAD PARANORMAL', 'SCREAM', 'JUEGOS DIABOLICOS', 'CARRIE', 'EL BEBE DE ROSEMARY', 'FRAGMENTADO', 'EL SEXTO SENTIDO', 'LOS OTROS', 'UNA MENTE BRILLANTE', 'RENA_CIENTE', 'LA FORMA DEL AGUA', 'TODO EN TODAS PARTES AL MISMO TIEMPO', 'DUNA', 'INTERESTELAR', 'NUEVE REINAS'],
            series: ['FRIENDS', 'LOST', 'HEROES', 'BONES', 'SUITS', 'DR HOUSE', 'SHERLOCK', 'WESTWORLD', 'NARCOS', 'DEXTER', 'BREAKING BAD', 'GAME OF THRONES', 'ESTA SUCEDIENDO', 'LOS SOPRANO', 'THE OFFICE', 'EL MANDALORIANO', 'BLACK MIRROR', 'THE CROWN', 'LA CASA DE PAPEL', 'EL JUEGO DEL CALAMAR', 'DARK', 'VIKINGOS', 'GREYS ANATOMY', 'LOS EXPEDIENTES SECRETOS X', 'MAD MEN', 'THE WIRE', 'BETTER CALL SAUL', 'EL CUENTO DE LA CRIADA', 'CHNOBYL', 'PEAKY BLINDERS', 'SINFONIA EN SELVA', 'THE BOYS', 'EL OSO', 'SUCESION', 'FLEABAG', 'BOJACK HORSEMAN', 'RICK Y MORTY', 'LOS SIMPSON', 'SOUTH PARK', 'FAMILY GUY', 'HOW I MET YOUR MOTHER', 'THE BIG BANG THEORY', 'MODERN FAMILY', 'MALCOLM EL DE EN MEDIO', 'PRISON BREAK', 'SCANDAL', 'EL MENTALISTA', 'CRIMINAL MINDS', 'SUPERNATURAL', 'COBRA KAI'],
            personajes: ['MICKEY MOUSE', 'HARRY POTTER', 'YODA', 'INDIANA JONES', 'SHERLOCK HOLMES', 'BATMAN', 'SUPERMAN', 'SPIDERMAN', 'WONDER WOMAN', 'IRON MAN', 'EL JOKER', 'DARTH VADER', 'LUKE SKYWALKER', 'PRINCIPESA LEIA', 'HAN SOLO', 'FRODO BOLSON', 'GANDALF', 'LEGOLAS', 'GOLLUM', 'VOLDEMORT', 'HERMIONE GRANGER', 'RON WEASLEY', 'ALBUS DUMBLEDORE', 'JAMES BOND', 'JACK SPARROW', 'TERMINATOR', 'ROCKY BALBOA', 'FORREST GUMP', 'KATNISS EVERDEEN', 'BELLA SWAN', 'EDWARD CULLEN', 'TONY MONTANA', 'VITO CORLEONE', 'HANNIBAL LECTER', 'NORMAN BATES', 'DRACULA', 'FRANKENSTEIN', 'EL HOMBRE LOBO', 'EL MONSTRUO DE LA LAGUNA', 'EL ZORRO', 'TARZAN', 'ROBIN HOOD', 'EL QUIJOTE', 'SANCHO PANZA', 'CAPITAN AMERICA', 'HULK', 'THOR', 'BLACK WIDOW', 'WOLVERINE', 'DEADPOOL', 'MARIO', 'LUIGI', 'PRINCIPESA PEACH', 'BOWSER', 'LINK', 'ZELDA', 'PIKACHU', 'SONIC', 'LARA CROFT', 'KRATOS', 'HOMERO SIMPSON', 'BART SIMPSON', 'PETER GRIFFIN', 'ERIC CARTMAN', 'BOB ESPONJA', 'PATRICIO ESTRELLA', 'MICKEY MOUSE', 'BUGS BUNNY', 'PATO LUCAS', 'TOM Y JERRY', 'SCOOBY-DOO', 'SHREK', 'BURRO', 'EL GATO CON BOTAS', 'ELSA', 'OLAF', 'SIMBA', 'MUFASA', 'SCAR', 'POKEMON', 'GOKU', 'VEGETA', 'NARUTO', 'LUFFY', 'SAILOR MOON', 'CENICIENTA', 'BLANCANIEVES', 'BELLA', 'ARIEL', 'MULAN', 'MAESTRO YODA', 'BOBA FETT', 'HAGRID', 'SEVERUS SNAPE', 'EL GRINCH', 'PETER PAN', 'CAPITAN GARFIO', 'ALICIA EN EL PAIS DE LAS MARAVILLAS', 'EL SOMBRERERO LOCO', 'WINNIE THE POOH'],
            libros: ['LA VUELTA AL MUNDO EN 80 DIAS', 'FARENHEIT 451', 'EL CODIGO DA VINCI', 'PROYECTO HAIL MARY', 'DON QUIJOTE DE LA MANCHA', 'CIEN ANOS DE SOLEDAD', 'EL PRINCIPITO', '1984', 'REBELION EN LA GRANJA', 'UN MUNDO FELIZ', 'CRIMEN Y CASTIGO', 'LOS MISERABLES', 'ORGULLO Y PREJUICIO', 'EL RETRATO DE DORIAN GRAY', 'DRACULA', 'FRANKENSTEIN', 'EL SENOR DE LOS ANILLOS', 'EL HOBBIT', 'HARRY POTTER Y LA PIEDRA FILOSOFAL', 'CRONICAS DE NARNIA', 'EL ALQUIMISTA', 'EL NOMBRE DE LA ROSA', 'LA SOMBRA DEL VIENTO', 'EL AMOR EN LOS TIEMPOS DEL COLERA', 'PEDRO PARAMO', 'RAYUELA', 'LA CASA DE LOS ESPIRITUS', 'ENSAYO SOBRE LA CEGUERA', 'EL TUNEL', 'METAMORFOSIS', 'ULISES', 'EL GRAN GATSBY', 'EL GUARDIAN ENTRE EL CENTENO', 'MATAR A UN RUISENOR', 'LAS UVAS DE LA IRA', 'MOBY DICK', 'LA ISLA DEL TESORO', 'EL CONDE DE MONTECRISTO', 'LOS TRES MOSQUETEROS', 'ESTUDIO EN ESCARLATA', 'EL PERFUME', 'IT', 'EL RESPLANDOR', 'CRONICA DE UNA MUERTE ANUNCIADA', 'EL ALEPH', 'LA TREGUA', 'EL PSICOANALISTA', 'LOS JUEGOS DEL HAMBRE', 'DUNA', 'SIDDHARTHA'],
            marcas: ['APPLE', 'NIKE', 'COCA-COLA', 'DISNEY', 'GOOGLE', 'AMAZON', 'TESLA', 'ADIDAS', 'SAMSUNG', 'STARBUCKS', 'MICROSOFT', 'TOYOTA', 'MERCEDES-BENZ', 'BMW', 'FERRARI', 'FORD', 'HONDA', 'VOLKSWAGEN', 'PEPSI', 'MCDONALDS', 'BURGER KING', 'NESTLE', 'KELLOGGS', 'DANONE', 'ZARA', 'H&M', 'GUCCI', 'LOUIS VUITTON', 'PRADA', 'CHANEL', 'ROLEX', 'CARTIER', 'SONY', 'NINTENDO', 'PLAYSTATION', 'NETFLIX', 'SPOTIFY', 'YOUTUBE', 'FACEBOOK', 'INSTAGRAM', 'TIKTOK', 'TWITTER', 'VISA', 'MASTERCARD', 'AMERICAN EXPRESS', 'PAYPAL', 'LOREAL', 'NIVEA', 'DOVE', 'COLGATE', 'GILLETTE', 'PAMPERS', 'LEGO', 'BARBIE', 'CANON', 'NIKON', 'ADOBE', 'INTEL', 'HP', 'DELL', 'IBM', 'ORACLE', 'UBER', 'AIRBNB', 'EBAY', 'FEDEX', 'DHL', 'UPS', 'SHELL', 'TOTAL', 'WALMART', 'IKEA', 'RED BULL', 'MONSTER', 'HYUNDAI']
        };

        let selectedCategories = ['all'];

        // Play beep sound
        function playBeep() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.value = 800; // Frequency in Hz
            oscillator.type = 'sine';

            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.2);
        }

        // Play final beep sound (deeper and longer)
        function playFinalBeep() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.value = 400; // Lower frequency (deeper sound)
            oscillator.type = 'sine';

            gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.6);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.6); // Longer duration
        }

        // Play terrifying gothic werewolf sound
        function playWerewolfSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const now = audioContext.currentTime;

            // Deep rumble ‚Äî low sawtooth descending
            const rumble = audioContext.createOscillator();
            const rumbleGain = audioContext.createGain();
            rumble.type = 'sawtooth';
            rumble.frequency.setValueAtTime(80, now);
            rumble.frequency.exponentialRampToValueAtTime(40, now + 1.8);
            rumbleGain.gain.setValueAtTime(0, now);
            rumbleGain.gain.linearRampToValueAtTime(0.45, now + 0.25);
            rumbleGain.gain.exponentialRampToValueAtTime(0.01, now + 1.8);
            rumble.connect(rumbleGain);
            rumbleGain.connect(audioContext.destination);
            rumble.start(now);
            rumble.stop(now + 1.8);

            // Mid growl ‚Äî sawtooth descending, slightly delayed
            const growl = audioContext.createOscillator();
            const growlGain = audioContext.createGain();
            growl.type = 'sawtooth';
            growl.frequency.setValueAtTime(140, now + 0.1);
            growl.frequency.exponentialRampToValueAtTime(70, now + 1.5);
            growlGain.gain.setValueAtTime(0, now + 0.1);
            growlGain.gain.linearRampToValueAtTime(0.3, now + 0.35);
            growlGain.gain.exponentialRampToValueAtTime(0.01, now + 1.5);
            growl.connect(growlGain);
            growlGain.connect(audioContext.destination);
            growl.start(now + 0.1);
            growl.stop(now + 1.5);

            // Dissonant shriek ‚Äî square wave descending, adds terror
            const shriek = audioContext.createOscillator();
            const shriekGain = audioContext.createGain();
            shriek.type = 'square';
            shriek.frequency.setValueAtTime(320, now + 0.3);
            shriek.frequency.exponentialRampToValueAtTime(160, now + 1.2);
            shriekGain.gain.setValueAtTime(0, now + 0.3);
            shriekGain.gain.linearRampToValueAtTime(0.12, now + 0.5);
            shriekGain.gain.exponentialRampToValueAtTime(0.01, now + 1.2);
            shriek.connect(shriekGain);
            shriekGain.connect(audioContext.destination);
            shriek.start(now + 0.3);
            shriek.stop(now + 1.2);
        }

        // Play ghostly mirror/echo doppleganger sound
        function playDopplegangerSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const now = audioContext.currentTime;

            // Two identical echoed notes ‚Äî the "double"
            [0, 0.28].forEach(delay => {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(440, now + delay);
                osc.frequency.exponentialRampToValueAtTime(220, now + delay + 0.7);
                gain.gain.setValueAtTime(0, now + delay);
                gain.gain.linearRampToValueAtTime(delay === 0 ? 0.3 : 0.15, now + delay + 0.05);
                gain.gain.exponentialRampToValueAtTime(0.01, now + delay + 0.7);
                osc.connect(gain);
                gain.connect(audioContext.destination);
                osc.start(now + delay);
                osc.stop(now + delay + 0.7);
            });

            // Eerie high shimmer underneath
            const shimmer = audioContext.createOscillator();
            const shimmerGain = audioContext.createGain();
            shimmer.type = 'triangle';
            shimmer.frequency.setValueAtTime(880, now);
            shimmer.frequency.linearRampToValueAtTime(660, now + 1.0);
            shimmerGain.gain.setValueAtTime(0.07, now);
            shimmerGain.gain.exponentialRampToValueAtTime(0.01, now + 1.0);
            shimmer.connect(shimmerGain);
            shimmerGain.connect(audioContext.destination);
            shimmer.start(now);
            shimmer.stop(now + 1.0);
        }

        // Play evil minion sound (like werewolf but higher and lighter)
        function playMinionSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const now = audioContext.currentTime;

            // Mid rumble ‚Äî higher than werewolf's
            const rumble = audioContext.createOscillator();
            const rumbleGain = audioContext.createGain();
            rumble.type = 'sawtooth';
            rumble.frequency.setValueAtTime(140, now);
            rumble.frequency.exponentialRampToValueAtTime(90, now + 1.3);
            rumbleGain.gain.setValueAtTime(0, now);
            rumbleGain.gain.linearRampToValueAtTime(0.3, now + 0.2);
            rumbleGain.gain.exponentialRampToValueAtTime(0.01, now + 1.3);
            rumble.connect(rumbleGain);
            rumbleGain.connect(audioContext.destination);
            rumble.start(now);
            rumble.stop(now + 1.3);

            // Higher growl
            const growl = audioContext.createOscillator();
            const growlGain = audioContext.createGain();
            growl.type = 'sawtooth';
            growl.frequency.setValueAtTime(240, now + 0.1);
            growl.frequency.exponentialRampToValueAtTime(140, now + 1.1);
            growlGain.gain.setValueAtTime(0, now + 0.1);
            growlGain.gain.linearRampToValueAtTime(0.2, now + 0.3);
            growlGain.gain.exponentialRampToValueAtTime(0.01, now + 1.1);
            growl.connect(growlGain);
            growlGain.connect(audioContext.destination);
            growl.start(now + 0.1);
            growl.stop(now + 1.1);

            // Lighter shriek
            const shriek = audioContext.createOscillator();
            const shriekGain = audioContext.createGain();
            shriek.type = 'square';
            shriek.frequency.setValueAtTime(520, now + 0.2);
            shriek.frequency.exponentialRampToValueAtTime(280, now + 0.9);
            shriekGain.gain.setValueAtTime(0, now + 0.2);
            shriekGain.gain.linearRampToValueAtTime(0.09, now + 0.4);
            shriekGain.gain.exponentialRampToValueAtTime(0.01, now + 0.9);
            shriek.connect(shriekGain);
            shriekGain.connect(audioContext.destination);
            shriek.start(now + 0.2);
            shriek.stop(now + 0.9);
        }

        // Play ethereal magic seer sound
        function playSeerSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const now = audioContext.currentTime;

            // Ascending magical chime ‚Äî C major arpeggio
            const notes = [523, 659, 784, 1047];
            notes.forEach((freq, i) => {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                osc.type = 'sine';
                osc.frequency.value = freq;
                const t = now + i * 0.13;
                gain.gain.setValueAtTime(0, t);
                gain.gain.linearRampToValueAtTime(0.28, t + 0.05);
                gain.gain.exponentialRampToValueAtTime(0.01, t + 0.9);
                osc.connect(gain);
                gain.connect(audioContext.destination);
                osc.start(t);
                osc.stop(t + 0.9);
            });

            // Shimmer ‚Äî high triangle wave sweep for sparkle
            const shimmer = audioContext.createOscillator();
            const shimmerGain = audioContext.createGain();
            shimmer.type = 'triangle';
            shimmer.frequency.setValueAtTime(1800, now);
            shimmer.frequency.linearRampToValueAtTime(2600, now + 0.6);
            shimmerGain.gain.setValueAtTime(0.08, now);
            shimmerGain.gain.exponentialRampToValueAtTime(0.01, now + 0.6);
            shimmer.connect(shimmerGain);
            shimmerGain.connect(audioContext.destination);
            shimmer.start(now);
            shimmer.stop(now + 0.6);
        }

        // Play mysterious fortune teller sound (descending minor arpeggio)
        function playFortuneTellerSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const now = audioContext.currentTime;

            // Descending C minor arpeggio: G5 ‚Üí Eb5 ‚Üí C5 ‚Üí G4
            const notes = [784, 622, 523, 392];
            notes.forEach((freq, i) => {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                osc.type = 'triangle';
                osc.frequency.value = freq;
                const t = now + i * 0.18;
                gain.gain.setValueAtTime(0, t);
                gain.gain.linearRampToValueAtTime(0.25, t + 0.06);
                gain.gain.exponentialRampToValueAtTime(0.01, t + 1.0);
                osc.connect(gain);
                gain.connect(audioContext.destination);
                osc.start(t);
                osc.stop(t + 1.0);
            });

            // Eerie low hum rising slightly underneath
            const hum = audioContext.createOscillator();
            const humGain = audioContext.createGain();
            hum.type = 'sine';
            hum.frequency.setValueAtTime(196, now);
            hum.frequency.linearRampToValueAtTime(220, now + 1.0);
            humGain.gain.setValueAtTime(0, now);
            humGain.gain.linearRampToValueAtTime(0.1, now + 0.3);
            humGain.gain.exponentialRampToValueAtTime(0.01, now + 1.2);
            hum.connect(humGain);
            humGain.connect(audioContext.destination);
            hum.start(now);
            hum.stop(now + 1.2);
        }

        // Play royal mason fanfare sound
        function playMasonSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const now = audioContext.currentTime;

            // Royal fanfare ‚Äî ascending brass notes (G4, C5, E5, G5)
            const fanfare = [
                { freq: 392, start: 0,    dur: 0.14 },
                { freq: 523, start: 0.17, dur: 0.14 },
                { freq: 659, start: 0.34, dur: 0.14 },
                { freq: 784, start: 0.51, dur: 0.55 },
            ];
            fanfare.forEach(({ freq, start, dur }) => {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                osc.type = 'sawtooth';
                osc.frequency.value = freq;
                const t = now + start;
                gain.gain.setValueAtTime(0, t);
                gain.gain.linearRampToValueAtTime(0.3, t + 0.02);
                gain.gain.setValueAtTime(0.3, t + dur - 0.05);
                gain.gain.exponentialRampToValueAtTime(0.01, t + dur);
                osc.connect(gain);
                gain.connect(audioContext.destination);
                osc.start(t);
                osc.stop(t + dur);
            });

            // Harmony on the final note (C5, a fifth below G5) for fullness
            const harmony = audioContext.createOscillator();
            const harmonyGain = audioContext.createGain();
            harmony.type = 'sawtooth';
            harmony.frequency.value = 523;
            harmonyGain.gain.setValueAtTime(0, now + 0.51);
            harmonyGain.gain.linearRampToValueAtTime(0.15, now + 0.53);
            harmonyGain.gain.exponentialRampToValueAtTime(0.01, now + 1.06);
            harmony.connect(harmonyGain);
            harmonyGain.connect(audioContext.destination);
            harmony.start(now + 0.51);
            harmony.stop(now + 1.06);
        }

        // Generate word hint: first letter + __ for every word
        // e.g. "LEON" ‚Üí "L__"   "MARTIN LUTHER KING" ‚Üí "M__  L__  K__"
        function getWordHint(word) {
            const parts = word.trim().split(/\s+/);
            return parts.map(w => w[0] + '__').join('   ');
        }

        // Initialize the game
        function initGame() {
            // Reset categories
            selectedCategories = ['all'];

            // Initialize category grid
            const categoryGrid = document.getElementById('categoryGrid');
            categoryGrid.innerHTML = '';

            const allBtn = document.createElement('button');
            allBtn.className = 'category-button active';
            allBtn.textContent = 'All';
            allBtn.dataset.category = 'all';
            allBtn.addEventListener('click', () => toggleCategory('all'));
            categoryGrid.appendChild(allBtn);

            Object.keys(wordCategories).forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'category-button';
                btn.textContent = category.charAt(0).toUpperCase() + category.slice(1);
                btn.dataset.category = category;
                btn.addEventListener('click', () => toggleCategory(category));
                categoryGrid.appendChild(btn);
            });

            // Initialize roles
            const rolesGrid = document.getElementById('rolesGrid');
            rolesGrid.innerHTML = '';

            const roleEmojis = { villager: 'üë®‚Äçüåæ', werewolf: 'üê∫', seer: 'üîÆ', mayor: 'üèÖ', mason: 'ü§ù', 'fortune-teller': 'üÉè', minion: 'üòà', apprentice: 'üéì', beholder: 'üëÅÔ∏è', thing: 'ü§ö', doppleganger: 'ü™û' };
            const roleShortLabels = { villager: 'VILLAGER', werewolf: 'WEREWOLF', seer: 'SEER', mayor: 'MAYOR', mason: 'MASON', 'fortune-teller': 'FORTUNE TELLER', minion: 'MINION', apprentice: 'APPRENTICE', beholder: 'BEHOLDER', thing: 'THING', doppleganger: 'DOPPLEGANGER' };

            let buttonIndex = 0;
            roles.forEach(role => {
                for (let i = 0; i < role.count; i++) {
                    const button = document.createElement('button');
                    button.className = `role-button ${role.type}`;
                    button.dataset.index = buttonIndex;
                    button.dataset.type = role.type;
                    button.innerHTML = `
                        <div class="role-emoji">${roleEmojis[role.type] || ''}</div>
                        <div class="role-label">${roleShortLabels[role.type] || role.label}</div>
                    `;

                    const currentIndex = buttonIndex;
                    button.addEventListener('click', () => toggleRole(currentIndex));
                    rolesGrid.appendChild(button);
                    buttonIndex++;
                }
            });

            // On first load apply default selection; on subsequent calls restore previous selection
            const totalRoles = roles.reduce((sum, r) => sum + r.count, 0);
            if (selectedRoles.length === 0) {
                selectedRoles = Array(totalRoles).fill(false);
                const defaultSelection = [0, 1, 2, 3, 8, 11]; // 4 villagers, 1 werewolf, 1 seer
                defaultSelection.forEach(index => { selectedRoles[index] = true; });
            }
            selectedRoles.forEach((selected, index) => {
                if (selected) {
                    const button = document.querySelector(`[data-index="${index}"]`);
                    if (button) button.classList.add('active');
                }
            });

            updatePlayButton();
            updateCategorySummary();
        }

        // Update category summary text
        function updateCategorySummary() {
            const el = document.getElementById('categorySummaryText');
            if (selectedCategories.includes('all')) {
                el.textContent = 'Categor√≠a: Todas';
            } else {
                const names = selectedCategories.map(c => c.charAt(0).toUpperCase() + c.slice(1));
                el.textContent = 'Categor√≠a: ' + names.join(', ');
            }
        }

        // Show / hide category screen
        function showCategoryScreen() {
            document.getElementById('setupScreen').style.display = 'none';
            document.getElementById('categoryScreen').style.display = 'block';
            document.getElementById('setupFooter').style.display = 'none';
        }

        function hideCategoryScreen() {
            document.getElementById('categoryScreen').style.display = 'none';
            document.getElementById('setupScreen').style.display = 'block';
            document.getElementById('setupFooter').style.display = 'block';
        }

        // Toggle category selection
        function toggleCategory(category) {
            if (category === 'all') {
                selectedCategories = ['all'];
            } else {
                selectedCategories = selectedCategories.filter(c => c !== 'all');
                if (selectedCategories.includes(category)) {
                    selectedCategories = selectedCategories.filter(c => c !== category);
                    if (selectedCategories.length === 0) {
                        selectedCategories = ['all'];
                    }
                } else {
                    selectedCategories.push(category);
                }
            }

            document.querySelectorAll('.category-button').forEach(btn => {
                btn.classList.toggle('active', selectedCategories.includes(btn.dataset.category));
            });
            updateCategorySummary();
        }

        // Toggle role selection
        function toggleRole(index) {
            const button = document.querySelector(`[data-index="${index}"]`);
            const type = button.dataset.type;

            if (type === 'mason') {
                // Masons are always toggled together ‚Äî both or none
                const newState = !selectedRoles[index];
                document.querySelectorAll('[data-type="mason"]').forEach(btn => {
                    const i = parseInt(btn.dataset.index);
                    selectedRoles[i] = newState;
                    btn.classList.toggle('active', newState);
                });
            } else {
                selectedRoles[index] = !selectedRoles[index];
                button.classList.toggle('active');
            }

            updatePlayButton();
        }

        // Update play button state
        function updatePlayButton() {
            const playButton = document.getElementById('playButton');
            const selectedCount = selectedRoles.filter(r => r).length;

            // Check if at least one werewolf and the seer are selected
            let hasWerewolf = false;
            let hasSeer = false;

            selectedRoles.forEach((selected, index) => {
                if (selected) {
                    const button = document.querySelector(`[data-index="${index}"]`);
                    const type = button.dataset.type;
                    if (type === 'werewolf') hasWerewolf = true;
                    if (type === 'seer') hasSeer = true;
                }
            });

            const canStart = selectedCount > 0 && hasWerewolf && hasSeer;
            playButton.disabled = !canStart;

            if (selectedCount === 0) {
                playButton.textContent = 'Select Players to Start';
            } else if (!hasWerewolf || !hasSeer) {
                playButton.textContent = 'Need at least 1 Werewolf & 1 Seer';
            } else {
                playButton.textContent = `Start Game (${selectedCount} players)`;
            }
        }

        // Start the game
        function startGame() {
            // Detect which special roles are active
            const hasFortuneTeller = selectedRoles.some((selected, index) => {
                if (!selected) return false;
                const button = document.querySelector(`[data-index="${index}"]`);
                return button && button.dataset.type === 'fortune-teller';
            });
            const hasMinion = selectedRoles.some((selected, index) => {
                if (!selected) return false;
                const button = document.querySelector(`[data-index="${index}"]`);
                return button && button.dataset.type === 'minion';
            });

            // Build game phases
            gamePhases = [
                { phase: 'intro', text: 'Todos cierren los ojos...', type: 'instruction' },
                { phase: 'mayor-open', text: 'Mayor, abre los ojos y selecciona una palabra...', type: 'word-selection' },
                { phase: 'mayor-close', text: 'Mayor, cierra los ojos...', type: 'instruction' },
                { phase: 'werewolves-open', text: 'Werewolves, abre los ojos y mira la palabra...', type: 'show-word' },
                { phase: 'werewolves-close', text: 'Werewolves, cierra los ojos...', type: 'instruction' },
                { phase: 'seer-open', text: 'Seer, abre los ojos y mira la palabra...', type: 'show-word' },
                { phase: 'seer-close', text: 'Seer, cierra los ojos...', type: 'instruction' },
                { phase: 'discussion', text: 'Todos abran los ojos! Tienen 4 minutos para adivinar la palabra...', type: 'timer', duration: 240 },
                { phase: 'outcome', text: 'Averiguaron la palabra?', type: 'outcome' }
            ];

            if (hasMinion) {
                const wolvesCloseIndex = gamePhases.findIndex(p => p.phase === 'werewolves-close');
                gamePhases.splice(wolvesCloseIndex + 1, 0,
                    { phase: 'minion-open', text: 'Minion, abre los ojos y encuentra a los Werewolves...', type: 'instruction' },
                    { phase: 'minion-close', text: 'Minion, cierra los ojos...', type: 'instruction' }
                );
            }

            const hasApprentice = selectedRoles.some((selected, index) => {
                if (!selected) return false;
                const button = document.querySelector(`[data-index="${index}"]`);
                return button && button.dataset.type === 'apprentice';
            });
            const hasDoppleganger = selectedRoles.some((selected, index) => {
                if (!selected) return false;
                const button = document.querySelector(`[data-index="${index}"]`);
                return button && button.dataset.type === 'doppleganger';
            });

            mayorRole = null;

            if (hasDoppleganger) {
                const mayorCloseIndex = gamePhases.findIndex(p => p.phase === 'mayor-close');
                gamePhases.splice(mayorCloseIndex + 1, 0,
                    { phase: 'doppleganger-open', text: 'Doppleganger, abre los ojos. Mira la carta de otra persona y comp√≥rtate como ese rol...', type: 'instruction' },
                    { phase: 'doppleganger-close', text: 'Doppleganger, cierra los ojos...', type: 'instruction' }
                );
            }

            if (hasFortuneTeller) {
                const seerCloseIndex = gamePhases.findIndex(p => p.phase === 'seer-close');
                gamePhases.splice(seerCloseIndex + 1, 0,
                    { phase: 'fortune-teller-open', text: 'Fortune Teller, abre los ojos...', type: 'show-hint' },
                    { phase: 'fortune-teller-close', text: 'Fortune Teller, cierra los ojos...', type: 'instruction' }
                );
            }

            if (hasApprentice) {
                // Ask the mayor for their secret role right after word selection
                const mayorOpenIndex = gamePhases.findIndex(p => p.phase === 'mayor-open');
                const mayorRoleOptions = [{ role: 'seer', label: 'Seer üîÆ' }];
                if (hasFortuneTeller) mayorRoleOptions.push({ role: 'fortune-teller', label: 'Fortune Teller üÉè' });
                mayorRoleOptions.push({ role: 'other', label: 'Otro' });
                gamePhases.splice(mayorOpenIndex + 1, 0,
                    { phase: 'mayor-role-reveal', text: 'Mayor, ¬øcu√°l es tu rol secreto?', type: 'mayor-role-selection', options: mayorRoleOptions }
                );

                // Apprentice opens after fortune-teller (if present) or seer
                const apprenticeInsertAfter = hasFortuneTeller ? 'fortune-teller-close' : 'seer-close';
                const apprenticeIndex = gamePhases.findIndex(p => p.phase === apprenticeInsertAfter);
                gamePhases.splice(apprenticeIndex + 1, 0,
                    { phase: 'apprentice-open', text: 'Apprentice, abre los ojos...', type: 'show-apprentice' },
                    { phase: 'apprentice-close', text: 'Apprentice, cierra los ojos...', type: 'instruction' }
                );
            }

            const hasMason = selectedRoles.some((selected, index) => {
                if (!selected) return false;
                const button = document.querySelector(`[data-index="${index}"]`);
                return button && button.dataset.type === 'mason';
            });
            if (hasMason) {
                let insertAfter = 'seer-close';
                if (hasApprentice) insertAfter = 'apprentice-close';
                else if (hasFortuneTeller) insertAfter = 'fortune-teller-close';
                const insertIndex = gamePhases.findIndex(p => p.phase === insertAfter);
                gamePhases.splice(insertIndex + 1, 0,
                    { phase: 'mason-open', text: 'Masons, abran los ojos y encu√©ntrense...', type: 'instruction' },
                    { phase: 'mason-close', text: 'Masons, cierren los ojos...', type: 'instruction' }
                );
            }

            const hasThing = selectedRoles.some((selected, index) => {
                if (!selected) return false;
                const button = document.querySelector(`[data-index="${index}"]`);
                return button && button.dataset.type === 'thing';
            });
            if (hasThing) {
                let insertAfter = 'seer-close';
                if (hasMason) insertAfter = 'mason-close';
                else if (hasApprentice) insertAfter = 'apprentice-close';
                else if (hasFortuneTeller) insertAfter = 'fortune-teller-close';
                const insertIndex = gamePhases.findIndex(p => p.phase === insertAfter);
                gamePhases.splice(insertIndex + 1, 0,
                    { phase: 'thing-open', text: 'The Thing, abre los ojos y toca el hombro de alguien cercano...', type: 'instruction' },
                    { phase: 'thing-close', text: 'The Thing, cierra los ojos...', type: 'instruction' }
                );
            }

            const hasBeholder = selectedRoles.some((selected, index) => {
                if (!selected) return false;
                const button = document.querySelector(`[data-index="${index}"]`);
                return button && button.dataset.type === 'beholder';
            });
            if (hasBeholder) {
                const visibleRoles = ['Seer'];
                if (hasFortuneTeller) visibleRoles.push('Fortune Teller');
                if (hasApprentice) visibleRoles.push('Apprentice');
                const last = visibleRoles.pop();
                const rolesText = visibleRoles.length > 0
                    ? visibleRoles.join(', ') + ' y ' + last
                    : last;
                const discussionIndex = gamePhases.findIndex(p => p.phase === 'discussion');
                gamePhases.splice(discussionIndex, 0,
                    { phase: 'beholder-open', text: `Beholder, abre los ojos. ${rolesText}, levanten la mano...`, type: 'instruction' },
                    { phase: 'beholder-close', text: 'Beholder, cierra los ojos...', type: 'instruction' }
                );
            }

            currentPhaseIndex = 0;
            selectedWord = '';
            selectedWordCategory = '';
            showGameScreen();
            displayCurrentPhase();
        }

        // Show game screen
        function showGameScreen() {
            document.getElementById('setupScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            document.getElementById('headerResetButton').style.display = 'block';
            document.getElementById('setupFooter').style.display = 'none';
        }

        // Show setup screen
        function showSetupScreen() {
            document.getElementById('setupScreen').style.display = 'block';
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('headerResetButton').style.display = 'none';
            document.getElementById('setupFooter').style.display = 'block';
        }

        // Display current phase
        function displayCurrentPhase() {
            const instructionText = document.getElementById('instructionText');
            const wordSelection = document.getElementById('wordSelection');
            const wordDisplay = document.getElementById('wordDisplay');
            const timerDisplay = document.getElementById('timer');
            const nextButton = document.getElementById('nextButton');
            const outcomeButtons = document.getElementById('outcomeButtons');

            // Hide all dynamic elements
            wordSelection.style.display = 'none';
            wordDisplay.style.display = 'none';
            timerDisplay.style.display = 'none';
            nextButton.style.display = 'block';
            outcomeButtons.style.display = 'none';

            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }

            if (currentPhaseIndex >= gamePhases.length) {
                return;
            }

            const phase = gamePhases[currentPhaseIndex];
            instructionText.textContent = phase.text;

            switch (phase.type) {
                case 'instruction':
                    // Just show text and next button
                    break;

                case 'word-selection':
                    wordSelection.style.display = 'flex';
                    wordSelection.innerHTML = '';
                    const randomWords = getRandomWords(3);
                    randomWords.forEach(item => {
                        const btn = document.createElement('button');
                        btn.className = 'word-button';
                        btn.innerHTML = `${item.word}<span class="word-category-label">${item.category}</span>`;
                        btn.addEventListener('click', () => selectWord(item.word, item.category));
                        wordSelection.appendChild(btn);
                    });
                    nextButton.style.display = 'none';
                    break;

                case 'show-word':
                    if (selectedWord) {
                        wordDisplay.innerHTML = `<span class="word-upside-down">${selectedWord}<span class="word-category-label">${selectedWordCategory}</span></span><div class="word-divider"></div><span>${selectedWord}<span class="word-category-label">${selectedWordCategory}</span></span>`;
                        wordDisplay.style.display = 'flex';
                    }
                    break;

                case 'show-hint':
                    if (selectedWord) {
                        const hint = getWordHint(selectedWord);
                        wordDisplay.innerHTML = `<span class="word-upside-down word-hint">${hint}<span class="word-category-label">${selectedWordCategory}</span></span><div class="word-divider"></div><span class="word-hint">${hint}<span class="word-category-label">${selectedWordCategory}</span></span>`;
                        wordDisplay.style.display = 'flex';
                    }
                    break;

                case 'mayor-role-selection':
                    wordSelection.style.display = 'flex';
                    wordSelection.innerHTML = '';
                    phase.options.forEach(({ role, label }) => {
                        const btn = document.createElement('button');
                        btn.className = 'word-button';
                        btn.textContent = label;
                        btn.addEventListener('click', () => selectMayorRole(role));
                        wordSelection.appendChild(btn);
                    });
                    nextButton.style.display = 'none';
                    break;

                case 'show-apprentice':
                    if (mayorRole === 'seer' && selectedWord) {
                        wordDisplay.innerHTML = `<span class="word-upside-down">${selectedWord}<span class="word-category-label">${selectedWordCategory}</span></span><div class="word-divider"></div><span>${selectedWord}<span class="word-category-label">${selectedWordCategory}</span></span>`;
                        wordDisplay.style.display = 'flex';
                    } else if (mayorRole === 'fortune-teller' && selectedWord) {
                        const apprenticeHint = getWordHint(selectedWord);
                        wordDisplay.innerHTML = `<span class="word-upside-down word-hint">${apprenticeHint}<span class="word-category-label">${selectedWordCategory}</span></span><div class="word-divider"></div><span class="word-hint">${apprenticeHint}<span class="word-category-label">${selectedWordCategory}</span></span>`;
                        wordDisplay.style.display = 'flex';
                    }
                    // If 'other': just instruction text, nothing shown
                    break;

                case 'timer':
                    timerDisplay.style.display = 'block';
                    nextButton.style.display = 'none';
                    outcomeButtons.style.display = 'flex';
                    startTimer(phase.duration);
                    break;

                case 'outcome':
                    // This is handled by outcome buttons
                    break;
            }
        }

        // Get random words
        function getRandomWords(count) {
            let availableWords = [];

            if (selectedCategories.includes('all')) {
                Object.entries(wordCategories).forEach(([category, words]) => {
                    words.forEach(word => availableWords.push({ word, category }));
                });
            } else {
                selectedCategories.forEach(category => {
                    if (wordCategories[category]) {
                        wordCategories[category].forEach(word => availableWords.push({ word, category }));
                    }
                });
            }

            const shuffled = [...availableWords].sort(() => Math.random() - 0.5);
            return shuffled.slice(0, count);
        }

        // Select word
        function selectWord(word, category) {
            selectedWord = word;
            selectedWordCategory = category;
            playBeep();
            currentPhaseIndex++;
            displayCurrentPhase();
        }

        // Mayor declares their secret role for the Apprentice
        function selectMayorRole(role) {
            mayorRole = role;
            const apprenticePhase = gamePhases.find(p => p.phase === 'apprentice-open');
            if (apprenticePhase) {
                if (role === 'seer') apprenticePhase.text = 'Apprentice, abre los ojos y mira la palabra...';
                else if (role === 'fortune-teller') apprenticePhase.text = 'Apprentice, abre los ojos y mira la pista...';
                else apprenticePhase.text = 'Apprentice, abre los ojos...';
            }
            playBeep();
            currentPhaseIndex++;
            displayCurrentPhase();
        }

        // Start timer
        function startTimer(seconds) {
            const timerDisplay = document.getElementById('timer');
            let remaining = seconds;

            function updateTimer() {
                const mins = Math.floor(remaining / 60);
                const secs = remaining % 60;
                timerDisplay.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;

                if (remaining <= 30) {
                    timerDisplay.classList.add('warning');
                } else {
                    timerDisplay.classList.remove('warning');
                }

                if (remaining <= 0) {
                    clearInterval(timerInterval);
                    timerDisplay.textContent = 'TIME\'S UP!';
                }
                remaining--;
            }

            updateTimer();
            timerInterval = setInterval(updateTimer, 1000);
        }

        // Next phase
        function nextPhase() {
            // Check which phase we're transitioning to and play the appropriate sound
            const nextPhase = gamePhases[currentPhaseIndex + 1];
            if (nextPhase && nextPhase.phase === 'doppleganger-open') {
                playDopplegangerSound();
            } else if (nextPhase && nextPhase.phase === 'werewolves-open') {
                playWerewolfSound();
            } else if (nextPhase && nextPhase.phase === 'minion-open') {
                playMinionSound();
            } else if (nextPhase && nextPhase.phase === 'seer-open') {
                playSeerSound();
            } else if (nextPhase && nextPhase.phase === 'fortune-teller-open') {
                playFortuneTellerSound();
            } else if (nextPhase && nextPhase.phase === 'mason-open') {
                playMasonSound();
            } else if (nextPhase && nextPhase.phase === 'apprentice-open') {
                if (mayorRole === 'seer') playSeerSound();
                else if (mayorRole === 'fortune-teller') playFortuneTellerSound();
                else playBeep();
            } else if (nextPhase && nextPhase.phase === 'discussion') {
                playFinalBeep();
            } else {
                playBeep();
            }

            currentPhaseIndex++;
            if (currentPhaseIndex >= gamePhases.length) {
                resetGame();
            } else {
                displayCurrentPhase();
            }
        }

        // Reset game
        function resetGame() {
            currentPhaseIndex = 0;
            gamePhases = [];
            showSetupScreen();
            initGame();
        }

        // Handle outcome - word guessed
        function handleWordGuessed() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }

            const instructionText = document.getElementById('instructionText');
            const outcomeButtons = document.getElementById('outcomeButtons');
            const timerDisplay = document.getElementById('timer');
            const oopsButton = document.getElementById('oopsButton');

            instructionText.textContent = 'Werewolves have 30 seconds to identify the Seer!';
            outcomeButtons.style.display = 'none';
            timerDisplay.style.display = 'block';
            oopsButton.style.display = 'block';
            startTimer(30);
        }

        // Handle outcome - word not guessed
        function handleWordNotGuessed() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }

            const instructionText = document.getElementById('instructionText');
            const outcomeButtons = document.getElementById('outcomeButtons');
            const timerDisplay = document.getElementById('timer');
            const oopsButton = document.getElementById('oopsButton');

            instructionText.textContent = 'You have 1 minute to identify the Werewolves!';
            outcomeButtons.style.display = 'none';
            timerDisplay.style.display = 'block';
            oopsButton.style.display = 'block';
            startTimer(60);
        }

        // Go back to outcome choice
        function handleOops() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }

            document.getElementById('instructionText').textContent = 'Averiguaron la palabra?';
            document.getElementById('timer').style.display = 'none';
            document.getElementById('oopsButton').style.display = 'none';
            document.getElementById('outcomeButtons').style.display = 'flex';
        }

        // Event listeners
        document.getElementById('categoryCogButton').addEventListener('click', showCategoryScreen);
        document.getElementById('categoryDoneButton').addEventListener('click', hideCategoryScreen);
        document.getElementById('playButton').addEventListener('click', startGame);
        document.getElementById('nextButton').addEventListener('click', nextPhase);
        document.getElementById('headerResetButton').addEventListener('click', resetGame);
        document.getElementById('wordGuessed').addEventListener('click', handleWordGuessed);
        document.getElementById('wordNotGuessed').addEventListener('click', handleWordNotGuessed);
        document.getElementById('oopsButton').addEventListener('click', handleOops);

        // Initialize on load
        initGame();
    </script>
</body>
</html>
